<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>約定時間功能使用說明</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #e67e22, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            font-size: 1.2em;
            color: #666;
        }
        
        .content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e67e22;
            display: flex;
            align-items: center;
        }
        
        .section h2::before {
            content: "📅";
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .section h3 {
            color: #34495e;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
            padding-left: 15px;
            border-left: 4px solid #f39c12;
        }
        
        .screenshot {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            margin: 20px 0;
            border: 3px solid #ecf0f1;
        }
        
        .screenshot-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(120deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
        }
        
        .screenshot-caption {
            color: #555;
            font-weight: bold;
            margin-top: 15px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #e67e22;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .feature-card h4 {
            color: #2c3e50;
            font-size: 1.2em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        
        .feature-card h4::before {
            content: "▶";
            color: #e67e22;
            margin-right: 8px;
            font-size: 0.9em;
        }
        
        .feature-card p, .feature-card li {
            color: #555;
            margin-bottom: 8px;
        }
        
        .feature-card ul {
            padding-left: 20px;
        }
        
        .highlight-box {
            background: linear-gradient(120deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #f39c12;
            border: 2px solid #f1c40f;
        }
        
        .highlight-box h4 {
            color: #d68910;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .warning-box {
            background: linear-gradient(120deg, #ffeaea 0%, #ffcdd2 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #e74c3c;
            border: 2px solid #ff6b6b;
        }
        
        .warning-box h4 {
            color: #c0392b;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .info-box {
            background: linear-gradient(120deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
            border: 2px solid #74b9ff;
        }
        
        .info-box h4 {
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .delete-box {
            background: linear-gradient(120deg, #f8d7da 0%, #e2c3c7 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #dc3545;
            border: 2px solid #dc3545;
        }
        
        .delete-box h4 {
            color: #721c24;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .process-flow {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .flow-step::before {
            content: counter(flow-counter);
            counter-increment: flow-counter;
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            background: #e67e22;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .flow-step-content {
            margin-left: 30px;
        }
        
        .flow-steps {
            counter-reset: flow-counter;
        }
        
        .status-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .status-box {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .status-available {
            background: linear-gradient(120deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }
        
        .status-unavailable {
            background: linear-gradient(120deg, #f8d7da 0%, #e2c3c7 100%);
            border: 2px solid #dc3545;
        }
        
        .operation-steps {
            counter-reset: step-counter;
        }
        
        .operation-steps li {
            counter-increment: step-counter;
            margin-bottom: 15px;
            padding-left: 40px;
            position: relative;
        }
        
        .operation-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #e67e22;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .permission-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .permission-card.allowed {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }
        
        .permission-card.denied {
            border-color: #dc3545;
            background: linear-gradient(135deg, #f8d7da 0%, #e2c3c7 100%);
        }
        
        .permission-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .permission-card.allowed h4::before {
            content: "✅";
            margin-right: 8px;
        }
        
        .permission-card.denied h4::before {
            content: "❌";
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .status-comparison {
                grid-template-columns: 1fr;
            }
            
            .permission-grid {
                grid-template-columns: 1fr;
            }
            
            .screenshot {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⏰ 約定時間功能使用說明</h1>
            <p>桌球比賽時間協調與邀約系統</p>
        </div>

        <div class="content">
            <!-- 功能概述 -->
            <div class="section">
                <h2>功能概述</h2>
                <p>約定時間功能是桌球管理系統的核心協調工具，讓使用者能夠靈活安排比賽時間、發送邀約通知，並與其他選手進行時間協調。系統提供多種時段選擇和自動通知機制，確保所有參與者都能及時收到約戰資訊。</p>
                
                <div class="highlight-box">
                    <h4>🎯 主要功能</h4>
                    <ul>
                        <li><strong>時段選擇</strong>：可選早中晚或自訂時段</li>
                        <li><strong>對戰邀約</strong>：與其他選手預約比賽時間</li>
                        <li><strong>系統通知</strong>：自動提醒約定的比賽時間</li>
                        <li><strong>靈活安排</strong>：支援彈性的時間協調機制</li>
                        <li><strong>邀約管理</strong>：完整的邀約生命週期管理，包含刪除功能</li>
                    </ul>
                </div>
            </div>

            <!-- 使用管道 -->
            <div class="section">
                <h2>約戰功能使用管道</h2>
                
                <h3>🏓 管道一：從計分頁面發起約戰</h3>
                <div class="screenshot-container">
                    <img src="https://github.com/iceapp-maker/tball/blob/main/docs/images/appoint_from_score.png?raw=true" alt="計分頁面約戰按鈕" class="screenshot">
                    <div class="screenshot-caption">圖：計分頁面右上角的約戰按鈕（📣按鈕）</div>
                </div>
                
                <div class="feature-card">
                    <h4>使用時機與優勢</h4>
                    <ul>
                        <li><strong>任何時候</strong>：只要想到有想要約戰的對象，都可選定選手後執行邀約</li>
                        <li><strong>比賽完成</strong>：四位選手資訊已在系統中，可進行下次約戰</li>
                    </ul>
                </div>

                <h3>🏟️ 管道二：戰況室比賽列表</h3>
                <div class="screenshot-container">
                    <img src="https://github.com/iceapp-maker/tball/blob/main/docs/images/contest_appoint.png?raw=true" alt="戰況室約戰按鈕" class="screenshot">
                    <div class="screenshot-caption">圖：戰況室比賽列表中的約戰按鈕狀態與成員回覆顯示</div>
                </div>

                <div class="warning-box">
                    <h4>⚠️ 重要：戰況室約戰權限限制</h4>
                    <p><strong>戰況室的約戰功能只開放給該賽程的全部參賽人員</strong></p>
                    <p>如果登入者不是此比賽的參賽選手之一，將無法從戰況室管道發起約戰。只有比賽的實際參與者才能使用此功能進行時間協調。</p>
                </div>

                <div class="status-comparison">
                    <div class="status-box status-available">
                        <h4>🟢 可用狀態</h4>
                        <p><strong>出賽點1：師師隊 vs 劉董隊</strong></p>
                        <p>綠色「約」按鈕，可以點擊發起約戰</p>
                    </div>
                    <div class="status-box status-unavailable">
                        <h4>⚪ 不可用狀態</h4>
                        <p><strong>出賽點5：紅茶隊 vs 言午許</strong></p>
                        <p>灰色「約」按鈕，已有約戰記錄處理中</p>
                    </div>
                </div>

                <div class="info-box">
                    <h4>💡 戰況室回覆狀態顯示</h4>
                    <p>在戰況室的對戰名片中，每位選手名稱底下會直接用<strong>文字顯示</strong>相約的回覆狀況，方便快速了解約戰進度：</p>
                    <ul>
                        <li><strong>已接受</strong>：該選手同意約戰</li>
                        <li><strong>未讀取</strong>：該選手尚未查看邀約</li>
                        <li><strong>已拒絕</strong>：該選手拒絕約戰</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <h4>⚠️ 重要：約戰按鈕狀態說明</h4>
                    <p><strong>「約」按鈕變灰色的原因：已有約戰記錄且在處理中</strong></p>
                    <p>必須等其中一方拒絕約戰後，按鈕才會重新變為可用狀態。這個設計避免了重複約戰和混亂的時間安排。</p>
                </div>
            </div>

            <!-- 被約方通知機制 -->
            <div class="section">
                <h2>被約方通知機制</h2>
                
                <h3>📋 挑戰通知詳細資訊</h3>
                <div class="screenshot-container">
                    <img src="https://github.com/iceapp-maker/tball/blob/main/docs/images/bell-notification.png?raw=true" alt="挑戰通知詳細資訊" class="screenshot">
                    <div class="screenshot-caption">圖：被約後的挑戰通知詳細資訊頁面</div>
                </div>
                
                <div class="feature-card">
                    <h4>通知內容說明</h4>
                    <ul>
                        <li>顯示「尚未過期」和「已過期」的挑戰</li>
                        <li>操作欄位顯示不同狀態（考慮中、接受、已接受等）</li>
                        <li>提供詳細的挑戰資訊和參與者名單</li>
                        <li>可查看所有相關的約戰記錄</li>
                        <li><strong>自己發起的約戰</strong>：系統會自動設為接受，也可手動設定</li>
                        <li><strong>刪除功能</strong>：發起人可刪除不需要的邀約</li>
                    </ul>
                </div>

                <h3>✅ 成員回覆狀態顯示</h3>
                <div class="screenshot-container">
                    <img src="https://github.com/iceapp-maker/tball/blob/main/docs/images/challenge_return.png?raw=true" alt="挑戰成員回覆狀態" class="screenshot">
                    <div class="screenshot-caption">圖：詳細挑戰列表頁中顯示約戰相關成員的回覆狀態</div>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>回覆狀態圖示</h4>
                        <ul>
                            <li><strong>✅ 打勾</strong>：該成員已接受約戰邀請</li>
                            <li><strong>⏳ 漏斗</strong>：該成員正在考慮中</li>
                            <li><strong>❌ 打X</strong>：該成員已拒絕約戰邀請</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <h4>狀態查看方式</h4>
                        <ul>
                            <li>每位成員名稱旁顯示對應圖示</li>
                            <li>可一目了然各成員回覆情況</li>
                            <li>協助發起人了解約戰進度</li>
                            <li>便於追蹤待回覆的成員</li>
                        </ul>
                    </div>
                </div>
                
                <h3>📱 個人資訊頁面通知</h3>
                <div class="screenshot-container">
                    <img src="https://github.com/iceapp-maker/tball/blob/main/docs/images/inform_appoint.png?raw=true" alt="個人資訊約戰通知" class="screenshot">
                    <div class="screenshot-caption">圖：登入者被約時，個人資訊頁面的待處理區顯示約戰訊息</div>
                </div>
                
                <div class="feature-card">
                    <h4>通知內容</h4>
                    <ul>
                        <li><strong>挑戰通知</strong>：2筆未讀約戰邀請</li>
                        <li><strong>賽程邀約</strong>：1筆待處理邀約</li>
                        <li><strong>詳細資訊</strong>：包含約戰隊伍名稱、比賽類型、時間等</li>
                        <li><strong>處理狀態</strong>：顯示「雙方已安排」或其他處理狀態</li>
                    </ul>
                </div>
            </div>

            <!-- 邀約刪除功能 -->
            <div class="section">
                <h2>邀約刪除功能</h2>
                
                <div class="delete-box">
                    <h4>🗑️ 重要更新：邀約刪除功能</h4>
                    <p>系統現已新增邀約刪除功能，讓發起人能夠有效管理不需要的邀約，避免列表混亂。</p>
                </div>
                
                <h3>🔐 刪除權限控制</h3>
                <div class="permission-grid">
                    <div class="permission-card allowed">
                        <h4>發起人權限</h4>
                        <ul>
                            <li><strong>可以刪除</strong>：自己發起的任何邀約</li>
                            <li><strong>適用範圍</strong>：未過期和已過期的邀約</li>
                            <li><strong>操作位置</strong>：挑戰列表頁面的操作欄</li>
                            <li><strong>按鈕顯示</strong>：紅色垃圾桶圖示 🗑️</li>
                        </ul>
                    </div>
                    
                    <div class="permission-card denied">
                        <h4>參與者限制</h4>
                        <ul>
                            <li><strong>無法刪除</strong>：被邀請的參與者不能刪除邀約</li>
                            <li><strong>替代操作</strong>：只能接受或拒絕邀請</li>
                            <li><strong>顯示狀態</strong>：無刪除按鈕或顯示「無權限」</li>
                            <li><strong>保護機制</strong>：避免意外刪除他人邀約</li>
                        </ul>
                    </div>
                </div>
                
                <h3>🛡️ 安全機制</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>確認對話框</h4>
                        <ul>
                            <li>刪除前會彈出確認視窗</li>
                            <li>提示「確定要刪除這個挑戰嗎？此操作無法復原！」</li>
                            <li>必須點擊「確定」才會執行刪除</li>
                            <li>可點擊「取消」中止操作</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <h4>操作狀態顯示</h4>
                        <ul>
                            <li><strong>刪除中</strong>：按鈕顯示「...」或「刪除中...」</li>
                            <li><strong>禁用狀態</strong>：刪除期間按鈕無法重複點擊</li>
                            <li><strong>成功提示</strong>：刪除完成後顯示成功訊息</li>
                            <li><strong>錯誤處理</strong>：失敗時顯示相應錯誤訊息</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <h4>數據清理</h4>
                        <ul>
                            <li>同時刪除相關的狀態記錄</li>
                            <li>清理 challenges 和 challenge_status_logs 表</li>
                            <li>立即從列表中移除被刪除的邀約</li>
                            <li>自動更新未讀計數</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <h4>界面更新</h4>
                        <ul>
                            <li>刪除後邀約立即從頁面消失</li>
                            <li>統計數字自動更新</li>
                            <li>通知計數重新計算</li>
                            <li>無需手動重新整理頁面</li>
                        </ul>
                    </div>
                </div>
                
                <h3>📍 刪除按鈕位置</h3>
                <div class="screenshot-container">
                    <img src="https://github.com/iceapp-maker/tball/blob/main/docs/images/delete_challenge.png?raw=true" alt="邀約刪除功能界面" class="screenshot">
                    <div class="screenshot-caption">圖：挑戰列表頁面中的刪除功能 - 只有發起人才能看到紅色垃圾桶刪除按鈕</div>
                </div>
                
                <div class="info-box">
                    <h4>💡 在不同區域的顯示方式</h4>
                    <ul>
                        <li><strong>收到的挑戰（未過期）</strong>：操作欄中，接受/拒絕選單旁邊</li>
                        <li><strong>收到的挑戰（已過期）</strong>：狀態顯示旁邊的垃圾桶按鈕</li>
                        <li><strong>我發起的挑戰（未過期）</strong>：操作欄中央的「🗑️ 刪除」按鈕</li>
                        <li><strong>我發起的挑戰（已過期）</strong>：操作欄中的垃圾桶圖示</li>
                    </ul>
                </div>
                
                <div class="warning-box">
                    <h4>⚠️ 刪除注意事項</h4>
                    <ul>
                        <li><strong>無法復原</strong>：刪除操作是永久性的，無法撤銷</li>
                        <li><strong>影響範圍</strong>：會影響所有參與者，邀約將從系統中完全消失</li>
                        <li><strong>建議時機</strong>：確定不需要此邀約時再執行刪除</li>
                        <li><strong>替代方案</strong>：如不確定，建議先拒絕邀約而非刪除</li>
                    </ul>
                </div>
            </div>

            <!-- 時段選擇功能 -->
            <div class="section">
                <h2>時段選擇功能</h2>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>🌅 早上時段</h4>
                        <p><strong>時間：8:00-12:00</strong></p>
                    </div>
                    
                    <div class="feature-card">
                        <h4>🌞 中午時段</h4>
                        <p><strong>時間：13:30-18:00</strong></p>
                    </div>
                    
                    <div class="feature-card">
                        <h4>🌙 晚上時段</h4>
                        <p><strong>時間：18:00-22:00</strong></p>
                    </div>
                    
                    <div class="feature-card">
                        <h4>🎯 自訂
